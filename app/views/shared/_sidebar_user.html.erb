<div class="flex flex-col flex-1 overflow-y-auto">
  <%# Main navigation menu %>
  <nav aria-label="<%= t("shared.sidebar.main_navigation") %>">
    <ul class="menu [[data-expanded=true]_&]:menu-xl w-full">
      <li>
        <div class="flex items-center justify-between gap-2">
          <%= active_link_to root_path, class: "flex-1 flex items-center gap-3 min-w-0", class_active: "menu-active", active: :exact do %>
            <%= image_tag "logo.png", class: "size-8 shrink-0 -ml-1 -mr-2" %>

            <span class="[[data-expanded=false]_&]:hidden truncate min-w-0">
              <%= Rails.application.config_for(:settings).dig(:site, :name) %>
            </span>
          <% end %>

          <%= link_to search_path, class: "btn btn-ghost btn-xs btn-square max-lg:hidden", title: t("shared.sidebar.search"), aria: { label: t("search.index.title") }, data: { turbo_frame: :modal, controller: "click", action: "keydown.meta+k@window->click#click keydown.ctrl+k@window->click#click" } do %>
            <%= inline_svg_tag "svg/magnifying-glass.svg", class: "size-4", aria: { hidden: true } %>
          <% end %>
        </div>
      </li>

      <%# Desktop: user links (mobile has these via profile page) %>
      <%= nav_link t("shared.navigation.organizations"), organizations_path, icon: "svg/compass.svg", active: [["organizations", "public/organizations", "users/invitations", "users/membership_requests"], ["index"]], wrapper_class: "max-lg:hidden" %>

      <li class="max-lg:hidden">
        <%= active_link_to user_notifications_path, class_active: "menu-active", class: "flex justify-between items-center whitespace-nowrap justify-start min-w-0", title: t("users.notifications.index.title"), data: { turbo_prefetch: false } do %>
          <%= inline_svg_tag "svg/bell.svg", class: "size-5 shrink-0", aria: { hidden: true } %>
          <span class="[[data-expanded=false]_&]:hidden truncate min-w-0"><%= t("users.notifications.index.title") %></span>
          <span class="notification-badge">
            <%= render "shared/notification_badge", count: current_user.unseen_notifications_count %>
          </span>
        <% end %>
      </li>

      <%= nav_link current_user.name, user_path, icon: user_avatar(current_user, classes: "size-6"), active: :exact, wrapper_class: "max-lg:hidden" %>

      <%# Mobile: org list (desktop has orgs via user links) %>
      <% Current.organizations&.each do |organization| %>
        <%= nav_link organization.name, organization_path(organization), icon: organization_avatar(organization, classes: "size-6"), wrapper_class: "lg:hidden" %>
      <% end %>

      <%= nav_link t("shared.navigation.organizations"), organizations_path, icon: "svg/compass.svg", wrapper_class: "lg:hidden" %>
    </ul>
  </nav>

  <div class="mt-auto">
    <ul class="menu [[data-expanded=true]_&]:menu-xl w-full">
      <% if current_user.admin? %>
        <% unless admin_links.empty? %>
          <li>
            <details>
              <summary>
                <%= inline_svg_tag "svg/cog-6-tooth.svg", class: "size-6 w-6 h-6" %>
                <span class="[[data-expanded=false]_&]:hidden truncate"> Admin </span>
              </summary>

              <ul>
                <% admin_links.each do |link| %>
                  <%= nav_link link[:name], link[:path], icon: link[:icon] %>
                <% end %>
              </ul>
            </details>
          </li>
        <% end %>
      <% end %>

      <li></li>
    </ul>
  </div>
</div>
